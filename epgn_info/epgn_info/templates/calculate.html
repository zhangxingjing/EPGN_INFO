{% extends 'base.html' %}

{% block title %}EPGN CALCULATE{% endblock %}

{% block link %}
<link rel="stylesheet" href="../../../epgn_front_end/layui/css/layui.css" media="all">
<link rel="stylesheet" href="../../../epgn_front_end/layui/css/admin.css" media="all">
<script src="../../../epgn_front_end/js/jquery-3.4.1.js"></script>
<script type="text/javascript" src="../../../epgn_front_end/js/vue_2.6.10.js"></script>
<script type="text/javascript" src="../../../epgn_front_end/js/axios-0.18.0.min.js"></script>
<link rel="stylesheet" href="../../../epgn_front_end/layui/css/modules/layer/default/layer.css">
{% endblock %}

{% block content %}
<div class="layui-fluid">
    <!-- 左侧从cookie中获取到的数据 -->
    <div style="float: left;">

        <!-- 已选数据的筛选在这里使用layui中的表格实现 ==> 显示一个文件名，同时添加右上方的功能区 -->
        <div class="layui-btn-group demoTable" style="margin-right: 10px">
            <button class="layui-btn layui-btn-sm" data-type=" getCheckData"
                style="margin-top: 10px;height: 37.89px">获取</button>
        </div>
        <div class="layui-form" style="float: left;width: 155px;margin-top: 10px;">
            <select name="direction" lay-verify="required" id="direction" lay-search="">
                <option value="">搜索关键字</option>
                <option value="1">这里显示勾选的文件名</option>
            </select>
        </div>
        <table id="data" lay-filter="test"></table>
    </div>

    <!-- 右侧关于算法部分==>Tab样式 -->
    <div class="layui-form layui-tab layui-tab-card" style="width:83%;float: left;">
        <div class="layui-inline">
            <label class="layui-form-label">算法选择:</label>
            <div class="layui-input-inline">
                <select name="modules" lay-verify="required" id="calculate" lay-search="">
                    <option value="">直接选择或搜索选择</option>
                    <option value="1">FFT</option>
                    <option value="2">倍频程</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item" style="margin-top: 10px">
            <label class="layui-form-label">{{ string }}</label>
            <div class="layui-input-block">
                <input type="checkbox" name="pipeline" title="VL" value="VL">
                <input type="checkbox" name="pipeline" title="VR" value="VR" checked="">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" id="run"> Run </button>
                <button type="reset" class="layui-btn layui-btn-normal">Reset</button>
            </div>
        </div>
        <!-- 这里对应上面li标签里面的内容 -->
        <div class="layui-tab-content" style="height: auto;">
            <div class="layui-tab-item layui-show">
                <div style="text-align: center">
                    <img src="../../../epgn_front_end/image/back.jpg" alt="算法处理的结果" style="width: 1000px; ">
                    <h2>这里发送算法的处理结果</h2>
                </div>
            </div>
        </div>

        <button class="layui-btn" lay-submit="" lay-filter="demo1" style="margin: 0px 10px 10px 0px; float: right">立即导出</button>
    </div>
</div>
{% endblock %}

{% block javascript %}
    <script>
        layui.config({base: '../../../epgn_front_end/home/'}).use('index', function () {
            var $ = layui.jquery,
                layer = layui.layer,
                admin = layui.admin,
                element = layui.element,
                table = layui.table,
                form = layui.form;
            });
    </script>

<script>
    $(" #run").click(function () {
        obj = document.getElementsByName("pipeline");
        check_pipeline = {};
        for (i in obj) {
            if (obj[i].checked) {
                check_pipeline[i] = obj[i].value;
            }
        } //
        layer.msg('发送请求, 返回当前提交数据返回的算法处理结果');
        $.ajax({
            url: /calculate/,
            type: "post",
            dataType: "json",
            data: {
                "data": {
                    "calculate": $("#calculate").val(),
                    "pipeline": check_pipeline,
                }
            },
            success: function (result) {
                $('#jumpbox').html(result);
                $('#jumpbox').modal('show');
            }
        });
    })
</script>

<script>
    layui.use(['form', 'table'], function () {
        var $ = layui.jquery,
            table = layui.table;

        //方法级渲染
        tableIns = table.render({
            width: 200,
            elem: '#data',
            page: false,
            height: 'full-130',
            // height: 800,
            url: "http://127.0.0.1:8000/car/",
            cols: [
                [{
                    type: 'checkbox',
                    LAY_CHECKED: true,
                }, {
                    field: 'file_name',
                    title: '文件名',
                    unresize: true,
                }]
            ],
        });

        var $ = layui.$,
            active = {
                getCheckData: function () { //获取选中数据
                    var checkStatus = table.checkStatus('idTest'),
                        data = checkStatus.data;
                    layer.alert(JSON.stringify(data));
                }
            };
    });
</script>

{% endblock %}